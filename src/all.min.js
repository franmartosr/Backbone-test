function inicio(){location.href="#tabla"}var Persona=Backbone.Model.extend({defaults:{nombre:"Sin nombre",edad:0,localidad:"Ninguna",fechaNacimiento:new Date(1950,1,1),sexo:"Hombre",estadoCivil:"Soltero"},localStorage:new Backbone.LocalStorage("listaPersonas"),mostrar:function(){alert("Datos añadidos/modificados:\n-Nombre: "+this.get("nombre")+"\n-Sexo: "+this.get("sexo")+"\n-Edad: "+this.get("edad")+"\n-Localidad: "+this.get("localidad")+"\n-Fecha de Nacimiento: "+this.get("fechaNacimiento")+"\n-Estado Civil: "+this.get("estadoCivil"))}}),Personas=Backbone.Collection.extend({model:Persona,localStorage:new Backbone.LocalStorage("listaPersonas")}),collectionView=Backbone.View.extend({initialize:function(){this.listenTo(this.collection,"add",this.filaNueva),this.listenTo(this.collection,"destroy",this.vacio),this.collection.fetch(),this.render()},template:_.template($("#tablaDatos").html()),render:function(){if(0!==this.collection.length){this.$el.html(this.template());for(var e=0;e<this.collection.length;e++)this.filaVista=new rowView({model:this.collection.models[e]})}else this.vacio()},filaNueva:function(){1===this.collection.length?this.render():this.filaVista=new rowView({model:this.collection.models[this.collection.length-1]})},vacio:function(){0===this.collection.length&&this.$el.html("No hay ningún dato disponible.")}}),sexo={Hombre:["Soltero","Casado"],Mujer:["Soltera","Casada"]},formulario=Backbone.Form.extend({schema:{id:{type:"Text",editorAttrs:{disabled:!0}},nombre:{type:"Text",editorAttrs:{placeholder:"Hola"}},edad:{type:"Number",editorAttrs:{min:"0",max:"125",onkeydown:"return false"}},localidad:"Text",fechaNacimiento:"Date",sexo:{type:"Radio",options:["Hombre","Mujer"]},estadoCivil:{type:"Select",options:sexo.Hombre}},events:{"click input[name=sexo]":"cambioSexo","click #guarda":"guarda"},cambioSexo:function(e){var t=sexo[e.currentTarget.value];this.fields.estadoCivil.editor.setOptions(t),$("select[name=estadoCivil]").val(t[0])},guarda:function(){if(null===$("select[name=estadoCivil]").val()){var e=this.model.get("estadoCivil");this.commit(),this.model.attributes.estadoCivil=e}else this.commit();this.model.mostrar(),this.model.save()}}),formView=Backbone.View.extend({initialize:function(){this.listenTo(this.model,"change",this.aniadir);for(var e=1;;e++)if(void 0===this.collection.get(e)){this.model.attributes.id=e;break}this.render()},events:{"click #cancel":"noFormu"},render:function(){this.formuNuevo=new formulario({model:this.model,template:_.template($("#formulario").html())}).render(),this.$el.html(this.formuNuevo.el)},noFormu:function(){this.formuNuevo.undelegateEvents(),this.undelegateEvents(),this.$el.empty()},aniadir:function(){this.collection.add(this.model),this.noFormu()}}),rowView=Backbone.View.extend({initialize:function(){this.listenTo(this.model,"change",this.noEdit),this.render()},tagName:"tr",className:"text-muted",template:_.template($("#fila").html()),render:function(){this.$el.html(this.template(this.model.toJSON())),$("#lista").append(this.$el)},events:{"click #edita":"editar","click #borra":"borrar","click #guarda":"noEdit","click #cancela":"noEdit"},borrar:function(){this.undelegateEvents(),this.$el.remove(),this.model.destroy()},editar:function(){this.formuEdit=new formulario({model:this.model,template:_.template($("#filaEdit").html())}).render(),this.$el.html(this.formuEdit.el)},noEdit:function(){void 0!==this.formuEdit&&(this.formuEdit.undelegateEvents(),this.$el.html(this.template(this.model.toJSON())))}}),enrutador=Backbone.Router.extend({routes:{formu:"formu",nueva:"nueva",tabla:"tabla"},formu:function(){this.formuVista=new formView({model:new Persona,el:"#formu",collection:coleccion}),this.toggleDiv()},nueva:function(){void 0!==this.formuVista&&(this.formuVista.formuNuevo.guarda(),this.toggleDiv())},tabla:function(){if(void 0!==this.formuVista){var e=this;$("#principal").slideDown("slow"),$("#formu").slideUp("slow",function(){e.formuVista.noFormu()})}},toggleDiv:function(){$("#principal").slideToggle("slow"),$("#formu").slideToggle("slow")}}),coleccion=new Personas,coleccionVista=new collectionView({collection:coleccion,el:"#tabla"}),rutas=new enrutador;Backbone.history.start();